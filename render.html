<html><!--=======================================================================-->

<head>
    <meta http-equiv="Content-Type" content="text/html">
    <meta charset="UTF-8">
    <title>Your Puzzle Here!</title>
    <link rel="stylesheet" href="./css/main.css">
    <script type="text/javascript" src="./js/epilog.js"></script>
    <script type="text/javascript" src="./js/worksheets.js"></script>
</head>

<!--=======================================================================-->

<body onload="initialize()" data-new-gr-c-s-check-loaded="14.1173.0" data-gr-ext-installed="">
    <center>

        <!--=======================================================================-->

        <h1>Your Puzzle Here!</h1>
        <table id="puzzle_grid">
            <thead>
                <tr>
                    <th></th>
                    <th>Column 1</th>
                    <th>Column 2</th>
                    <th>Column 3</th>
                    <th>Column 4</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>First Row</th>
                    <td><select class="cell-select" id="cell(1,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(1,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(1,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(1,4)" onchange="modselector(this)"></select></td>
                </tr>
                <tr>
                    <th>Second Row</th>
                    <td><select class="cell-select" id="cell(2,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(2,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(2,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(2,4)" onchange="modselector(this)"></select></td>
                </tr>
                <tr>
                    <th>Third Row</th>
                    <td><select class="cell-select" id="cell(3,4)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(3,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(3,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(3,4)" onchange="modselector(this)"></select></td>
                <tr>
                    <th>Fourth Row</th>
                    <td><select class="cell-select" id="cell(4,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(4,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(4,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(4,4)" onchange="modselector(this)"></select></td>
                </tr>
            </tbody>
        </table>
    </center>
    <div>
        <button class="btn btn-primary" onclick="modbutton(this)" id="verify_button" widget="button">Verify Your
            Solution!</button>
    </div>
    <div>
        <button class="btn btn-primary" onclick="modbutton(this)" id="solution_button" widget="button">Check One
            Potential Solution!</button>
    </div>

    <div class="hidden-message-win" id="win_message">
        Congratulations! You WIN the game!
    </div>

    <div class="hidden-message-lose" id="lose_message">
        Sorry! You LOSE the game!
    </div>

    <center>
        <table id="puzzle_grid_ans" class="ans_table">
            <thead>
                <tr>
                    <th></th>
                    <th>Column 1</th>
                    <th>Column 2</th>
                    <th>Column 3</th>
                    <th>Column 4</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>First Row</th>
                    <td><select class="cell-select" id="ans_cell(1,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(1,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(1,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(1,4)" onchange="modselector(this)"></select></td>
                </tr>
                <tr>
                    <th>Second Row</th>
                    <td><select class="cell-select" id="ans_cell(2,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(2,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(2,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(2,4)" onchange="modselector(this)"></select></td>
                </tr>
                <tr>
                    <th>Third Row</th>
                    <td><select class="cell-select" id="ans_cell(3,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(3,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(3,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(3,4)" onchange="modselector(this)"></select></td>
                <tr>
                    <th>Fourth Row</th>
                    <td><select class="cell-select" id="ans_cell(4,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(4,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(4,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="ans_cell(4,4)" onchange="modselector(this)"></select></td>
                </tr>
            </tbody>
        </table>

        <script>
            function getEmojiOptions() {
                const emojis = [
                    { value: "", display: "" },
                    { value: "blue_circle", display: "🔵" },
                    { value: "red_circle", display: "🔴" },
                    { value: "green_circle", display: "🟢" },
                    { value: "yellow_circle", display: "🟡" },
                    { value: "blue_square", display: "🟦" },
                    { value: "red_square", display: "🟥" },
                    { value: "green_square", display: "🟩" },
                    { value: "yellow_square", display: "🟨" },
                    { value: "blue_heart", display: "💙" },
                    { value: "red_heart", display: "❤️" },
                    { value: "green_heart", display: "💚" },
                    { value: "yellow_heart", display: "💛" },
                    { value: "blue_star", display: "⭐" }, // TODO: change the color using css here
                    { value: "red_star", display: "🌟" },
                    { value: "green_star", display: "🌠" },
                    { value: "yellow_star", display: "🌟" },
                ];

                return emojis.map(emoji => `<option value="${emoji.value}">${emoji.display}</option>`).join('');
            }

            document.querySelectorAll('.cell-select').forEach(select => {
                select.innerHTML = getEmojiOptions();
            });
        </script>


        <dataset id="lambda" type="text/hrf" style="display:none">
            puzzle_size(4,4)
            init_puzzle

            column_name(0, "1")
            column_name(1, "2")
            column_name(2, "3")
            column_name(3, "4")

            verb("is at the same column as",is)
            verb("is to the left of",is_to_left_of)
            verb("is to the right of",is_to_right_of)
            verb("is to the either side of",is_to_either_side_of)
            verb("is at column",is_at_certain_location)

            clue_type(is_at_certain_location)
            clue_type(is)
            clue_type(is_to_left_of)
            clue_type(is_to_right_of)
            clue_type(is_to_either_side_of)

            iscell(cell(1,1))
            iscell(cell(2,2))

            shape(circle)
            shape(square)
            shape(heart)
            shape(star)

            color(blue)
            color(red)
            color(green)
            color(yellow)

            <!-- Map emoji value to shape and color -->
            <!-- emoji(V, S, C): V is value, S is shape, C is color -->
            emoji(blue_circle, circle, blue)
            emoji(red_circle, circle, red)
            emoji(green_circle, circle, green)
            emoji(yellow_circle, circle, yellow)
            emoji(blue_square, square, blue)
            emoji(red_square, square, red)
            emoji(green_square, square, green)
            emoji(yellow_square, square, yellow)
            emoji(blue_heart, heart, blue)
            emoji(red_heart, heart, red)
            emoji(green_heart, heart, green)
            emoji(yellow_heart, heart, yellow)
            emoji(blue_star, star, blue)
            emoji(red_star, star, red)
            emoji(green_star, star, green)
            emoji(yellow_star, star, yellow)

        </dataset>

        <!-- ======================================================================= -->

        <ruleset id="library" type="text/hrf" style="display:none">
            select(cell(R, C), V)::value(cell(R, C), V)
            select(cell(R, C), V):: value(cell(R, C), V1) ==> ~value(cell(R, C), V1)


            <!-- Reltaions -->
            <!-- on the same Row
                on the same column 
                at a specific location either row or column 
                On the same row: directly to the left / to the right 
                on the same column: directly on top of/ below
                clue regarding object: give both color and shape -->

            <!-- randomly generate a valid grid -->

            valid_row_color([C1, C2, C3, C4]) :-
                color(C1) & color(C2) & color(C3) & color(C4) & mutex(C1, C2, C3, C4)
            
            random_row_color(C) :- evaluate(choose(X, valid_row_color(X)), C)

            valid_grid_shape([S11, S12, S13, S14, S21, S22, S23, S24, S31, S32, S33, S34, S41, S42, S43, S44]) :-
                shape(S11) & shape(S12) & shape(S13) & shape(S14) & mutex(S11, S12, S13, S14) &
                shape(S21) & shape(S22) & shape(S23) & shape(S24) & mutex(S21, S22, S23, S24) &
                mutex(S11, S21) & mutex(S12, S22) & mutex(S13, S23) & mutex(S14, S24) &
                shape(S31) & shape(S32) & shape(S33) & shape(S34) & mutex(S31, S32, S33, S34) &
                mutex(S11, S21, S31) & mutex(S12, S22, S32) & mutex(S13, S23, S33) & mutex(S14, S24, S34) &
                shape(S41) & shape(S42) & shape(S43) & shape(S44) & mutex(S41, S42, S43, S44) &
                mutex(S11, S21, S31, S41) & mutex(S12, S22, S32, S42) & mutex(S13, S23, S33, S43) & mutex(S14, S24, S34, S44)

            random_grid_shape(S) :- evaluate(choose(X, valid_grid_shape(X)), S)

            random_grid([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) :-
                random_row_color([C1, C2, C3, C4]) & 
                random_grid_shape([S11, S12, S13, S14, S21, S22, S23, S24, S31, S32, S33, S34, S41, S42, S43, S44]) &
                emoji(X11, S11, C1) & emoji(X12, S12, C1) & emoji(X13, S13, C1) & emoji(X14, S14, C1) &
                emoji(X21, S21, C2) & emoji(X22, S22, C2) & emoji(X23, S23, C2) & emoji(X24, S24, C2) &
                emoji(X31, S31, C3) & emoji(X32, S32, C3) & emoji(X33, S33, C3) & emoji(X34, S34, C3) &
                emoji(X41, S41, C4) & emoji(X42, S42, C4) & emoji(X43, S43, C4) & emoji(X44, S44, C4)
            

            <!-- verify solution -->
            click(verify_button) :: check() ==> style(win_message, display, block)
            click(verify_button) :: check() & ~style(lose_message, display, none) ==> style(lose_message, display, none)
            & ~style(lose_message, display, block)

            click(verify_button) :: ~check() ==> style(lose_message, display, block)
            click(verify_button) :: ~check() & ~style(win_message, display, none) ==> style(win_message, display, none)
            & ~style(win_message, display, block)

            check() :- value(cell(1,1), blue_circle)
            
            <!-- verify if a grid satisfied the basic rule (don't use it for generation because it is not optimized for generation) -->
            valid_grid([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) :-
                emoji(X11, S11, C1) & emoji(X12, S12, C1) & emoji(X13, S13, C1) & emoji(X14, S14, C1) &
                mutex(S11, S12, S13, S14) &
                emoji(X21, S21, C2) & emoji(X22, S22, C2) & emoji(X23, S23, C2) & emoji(X24, S24, C2) &
                mutex(S21, S22, S23, S24) & mutex(C1, C2) &
                emoji(X31, S31, C3) & emoji(X32, S32, C3) & emoji(X33, S33, C3) & emoji(X34, S34, C3) &
                mutex(S31, S32, S33, S34) & mutex(C1, C2, C3) &
                emoji(X41, S41, C4) & emoji(X42, S42, C4) & emoji(X43, S43, C4) & emoji(X44, S44, C4) &
                mutex(S41, S42, S43, S44) & mutex(C1, C2, C3, C4)

            <!-- check answer -->
            click(solution_button) :: style(puzzle_grid_ans, display, block)

            <!-- helper functions -->
            <!-- get_nth(L, N, E) :- get the "N"th element in list "L", store the element in "E" -->
            <!-- TODO: has bug!!!! -->
            get_nth(E!_, 0, E)
            get_nth(_!L, N, E) :- geq(N, 1) & evaluate(minus(N, 1), N1) & get_nth(L, N1, E)

        </ruleset>
        <!--=======================================================================-->

    </center>

</body>

<grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open">
        <style>
            div.grammarly-desktop-integration {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            div.grammarly-desktop-integration:before {
                content: attr(data-content);
            }
        </style>
        <div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration"
            data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}">
        </div>
    </template></grammarly-desktop-integration>

</html>