<html><!--=======================================================================-->

<head>
    <meta http-equiv="Content-Type" content="text/html">
    <meta charset="UTF-8">
    <title>Your Puzzle Here!</title>
    <link rel="stylesheet" href="./css/main.css">
</head>

<!--=======================================================================-->

<body onload="initialize()" data-new-gr-c-s-check-loaded="14.1173.0" data-gr-ext-installed="">
    <!-- <center>
        <input id='testnode'
        type='text'
        value='hello'
        size='30'
        style='color:black'
        display ='none'/>
    </center> -->
    <center>

        <!--=======================================================================-->

        <h1 id="heading">Your Puzzle Here!</h1>
        <table id="puzzle_grid" >
            <thead>
                <tr>
                    <th></th>
                    <th>Column 1</th>
                    <th>Column 2</th>
                    <th>Column 3</th>
                    <th>Column 4</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>First Row</th>
                    <td><select class="cell-select" id="cell(1,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(1,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(1,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(1,4)" onchange="modselector(this)"></select></td>
                </tr>
                <tr>
                    <th>Second Row</th>
                    <td><select class="cell-select" id="cell(2,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(2,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(2,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(2,4)" onchange="modselector(this)"></select></td>
                </tr>
                <tr>
                    <th>Third Row</th>
                    <td><select class="cell-select" id="cell(3,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(3,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(3,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(3,4)" onchange="modselector(this)"></select></td>
                <tr>
                    <th>Fourth Row</th>
                    <td><select class="cell-select" id="cell(4,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(4,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(4,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-select" id="cell(4,4)" onchange="modselector(this)"></select></td>
                </tr>
            </tbody>
        </table>
    </center>
    <span id="clue_section" display="none">
        <h1 class="clues_heading" id="clues_heading">Clues~~</h1>
        <div class="clue-container">
            <span id="clue1" class="clue">Clue 1</span>
            <span id="clue2" class="clue">Clue 2</span>
            <span id="clue3" class="clue">Clue 3</span>
            <span id="clue4" class="clue">Clue 4</span>
            <span id="clue5" class="clue">Clue 5</span>
            <span id="clue6" class="clue">Clue 6</span>
            <span id="clue7" class="clue">Clue 7</span>
        </div>
    </span>
    <div>
        <button class="btn btn-primary" onclick="modbutton(this)" id="rule_button" widget="button">Show Me the Rules!</button>
    </div> 
    <div>
        <button class="btn btn-primary" onclick="modbutton(this)" id="start_button" widget="button">Start the GAME!</button>
        <!-- TODO: disable / hide this button when game started -->
    </div>
    <div>
        <button class="btn btn-primary" onclick="modbutton(this)" id="add_hint" widget="button">Add some Hints!</button>
        <!-- TODO: disable / hide this button when game started -->
    </div>
    <div>
        <button class="btn btn-primary" onclick="modbutton(this)" id="verify_button" widget="button">Verify Your
            Solution!</button>
        <!-- TODO: disable /hide these two buttons when start game is not hit -->
    </div>
    <div>
        <button class="btn btn-primary" onclick="modbutton(this)" id="solution_button" widget="button">Check One
            Potential Solution!</button>
    </div>

    <div class="hidden-message-win" id="win_message">
        Congratulations! You WIN the game!
    </div>

    <div class="hidden-message-lose" id="lose_message">
        Sorry! You LOSE the game!
    </div>

    <center>
        <table id="puzzle_grid_ans" class="ans_table">
            <thead>
                <tr>
                    <th></th>
                    <th>Column 1</th>
                    <th>Column 2</th>
                    <th>Column 3</th>
                    <th>Column 4</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>First Row</th>
                    <td><select class="cell-ans" id="ans_cell(1,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(1,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(1,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(1,4)" onchange="modselector(this)"></select></td>
                </tr>
                <tr>
                    <th>Second Row</th>
                    <td><select class="cell-ans" id="ans_cell(2,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(2,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(2,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(2,4)" onchange="modselector(this)"></select></td>
                </tr>
                <tr>
                    <th>Third Row</th>
                    <td><select class="cell-ans" id="ans_cell(3,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(3,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(3,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(3,4)" onchange="modselector(this)"></select></td>
                <tr>
                    <th>Fourth Row</th>
                    <td><select class="cell-ans" id="ans_cell(4,1)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(4,2)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(4,3)" onchange="modselector(this)"></select></td>
                    <td><select class="cell-ans" id="ans_cell(4,4)" onchange="modselector(this)"></select></td>
                </tr>
            </tbody>
        </table>
    </center>


    <center>
        <dataset id="lambda" type="text/hrf" style="display:none">
            init_puzzle

            row(1)
            row(2)
            row(3)
            row(4)

            col(1)
            col(2)
            col(3)
            col(4)

            total_clues(5)

            shape(circle)
            shape(square)
            shape(heart)
            shape(book)

            color(blue)
            color(red)
            color(green)
            color(yellow)

            translate(red_circle, "🔴")
            translate(red_heart, "❤️")
            translate(red_square, "🟥")
            translate(red_book, "📕")

            translate(blue_circle, "🔵")
            translate(blue_heart, "💙")
            translate(blue_square, "🟦")
            translate(blue_book, "📘")

            translate(yellow_circle, "🟡")
            translate(yellow_heart, "💛")
            translate(yellow_square, "🟨")
            translate(yellow_book, "📒")

            translate(green_circle, "🟢")
            translate(green_heart, "💚")
            translate(green_square, "🟩")
            translate(green_book, "📗")

            shape_to_emoji(circle, "⚫")
            shape_to_emoji(heart, "🖤")
            shape_to_emoji(square, "⬛")
            shape_to_emoji(book, "📓")

            color_translate(green, "green 🟩")
            color_translate(red, "red 🟥")
            color_translate(yellow, "yellow 🟨")
            color_translate(blue, "blue 🟦")
            

            <!-- Map emoji value to shape and color -->
            <!-- emoji(V, S, C): V is value, S is shape, C is color -->
            emoji(blue_circle, circle, blue)
            emoji(red_circle, circle, red)
            emoji(green_circle, circle, green)
            emoji(yellow_circle, circle, yellow)
            emoji(blue_square, square, blue)
            emoji(red_square, square, red)
            emoji(green_square, square, green)
            emoji(yellow_square, square, yellow)
            emoji(blue_heart, heart, blue)
            emoji(red_heart, heart, red)
            emoji(green_heart, heart, green)
            emoji(yellow_heart, heart, yellow)
            emoji(blue_book, book, blue)
            emoji(red_book, book, red)
            emoji(green_book, book, green)
            emoji(yellow_book, book, yellow)

        </dataset>

        <!-- ======================================================================= -->

        <ruleset id="library" type="text/hrf" style="display:none">
            <!-- select an element for the grid -->
            select(cell(R, C), V):: value(cell(R, C), V)
            select(cell(R, C), V):: value(cell(R, C), V1) ==> ~value(cell(R, C), V1)

            <!-- randomly generate a valid grid -->

            valid_row_color([C1, C2, C3, C4]) :-
                color(C1) & color(C2) & color(C3) & color(C4) & mutex(C1, C2, C3, C4)
            
            random_row_color(C) :- evaluate(choose(X, valid_row_color(X)), C)

            valid_grid_shape([S11, S12, S13, S14, S21, S22, S23, S24, S31, S32, S33, S34, S41, S42, S43, S44]) :-
                shape(S11) & shape(S12) & shape(S13) & shape(S14) & mutex(S11, S12, S13, S14) &
                shape(S21) & shape(S22) & shape(S23) & shape(S24) & mutex(S21, S22, S23, S24) &
                mutex(S11, S21) & mutex(S12, S22) & mutex(S13, S23) & mutex(S14, S24) &
                shape(S31) & shape(S32) & shape(S33) & shape(S34) & mutex(S31, S32, S33, S34) &
                mutex(S11, S21, S31) & mutex(S12, S22, S32) & mutex(S13, S23, S33) & mutex(S14, S24, S34) &
                shape(S41) & shape(S42) & shape(S43) & shape(S44) & mutex(S41, S42, S43, S44) &
                mutex(S11, S21, S31, S41) & mutex(S12, S22, S32, S42) & mutex(S13, S23, S33, S43) & mutex(S14, S24, S34, S44)

            random_grid_shape(S) :- evaluate(choose(X, valid_grid_shape(X)), S)

            random_grid([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) :-
                random_row_color([C1, C2, C3, C4]) & 
                random_grid_shape([S11, S12, S13, S14, S21, S22, S23, S24, S31, S32, S33, S34, S41, S42, S43, S44]) &
                emoji(X11, S11, C1) & emoji(X12, S12, C1) & emoji(X13, S13, C1) & emoji(X14, S14, C1) &
                emoji(X21, S21, C2) & emoji(X22, S22, C2) & emoji(X23, S23, C2) & emoji(X24, S24, C2) &
                emoji(X31, S31, C3) & emoji(X32, S32, C3) & emoji(X33, S33, C3) & emoji(X34, S34, C3) &
                emoji(X41, S41, C4) & emoji(X42, S42, C4) & emoji(X43, S43, C4) & emoji(X44, S44, C4)
                        
            <!-- init Game -->
            click(start_button) :: init_puzzle & random_grid([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) 
                ==> style(puzzle_grid, display, block) &
                    ~init_puzzle & 
                    fill_in([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) & can_add_hint

            click(add_hint) :: ~init_puzzle & can_add_hint & clue_set(ClueSet)
                    ==> ourclue(ClueSet) & display(ClueSet) & ~can_add_hint & ~style(add_hint,display, "inline-block") 
    
            <!-- display clues test -->
            <!-- shape of cell -->
            generate_single_hint([Clue_Type, Detail], Sentence) :- 
            evaluate(Clue_Type, shape_of_cell) & evaluate(Detail, [Shape, R, C]) & shape_to_emoji(Shape, TS) & evaluate(stringjoin(["The shape at row", R, "column", C, "is", TS]), Sentence)
            
            <!-- emoji_of_cell -->
            generate_single_hint([Clue_Type, Detail], Sentence) :- 
            evaluate(Clue_Type, emoji_of_cell) & evaluate(Detail, [Emoji, R, C]) & translate(Emoji, TEmoji) & evaluate(stringjoin([TEmoji, "is at row", R, "column", C]), Sentence)

            <!-- left_of -->
            generate_single_hint([Clue_Type, Detail], Sentence) :- 
            evaluate(Clue_Type, left_of) & evaluate(Detail, [Left, Right]) & translate(Left, TLeft) & translate(Right, TRight) & evaluate(stringjoin([TLeft, "is to the left of", TRight]), Sentence) 

            <!-- top_of -->
            generate_single_hint([Clue_Type, Detail], Sentence) :- 
            evaluate(Clue_Type, top_of) & evaluate(Detail, [Top, Bottom]) & translate(Top, TTop) & translate(Bottom, TBottom) & evaluate(stringjoin([TTop, "is on top of", TBottom]), Sentence) 
            
            <!-- color_of_row -->
            generate_single_hint([Clue_Type, Detail], Sentence) :- 
            evaluate(Clue_Type, color_of_row) & evaluate(Detail, [Color, R]) & color_translate(Color, TC) & evaluate(stringappend("The color of row ", R, " is ", TC), Sentence)  
            
            show_clue_section():: style(clue1, display, inline) & ~style(clue1, display, none) & style(clue2, display, inline) & ~style(clue2, display, none) & style(clue3, display, inline) & ~style(clue3, display, none) 
            & style(clue4, display, inline) & ~style(clue4, display, none) & style(clue5, display, inline) & ~style(clue5, display, none) & style(clue6, display, inline) & ~style(clue6, display, none)
            & style(clues_heading, display, inline) & ~style(clues_heading, display, none) 
                        
            display(ClueSet) :: evaluate(length(ClueSet), 6) & evaluate(ClueSet, [H1, H2, H3, H4, H5, H6]) 
            & generate_single_hint(H1,S1) & generate_single_hint(H2,S2) & generate_single_hint(H3,S3) & generate_single_hint(H4,S4) & generate_single_hint(H5,S5) & generate_single_hint(H6,S6)
            ==> innerhtml(clue1, S1)& innerhtml(clue2, S2)& innerhtml(clue3, S3)& innerhtml(clue4, S4)& innerhtml(clue5, S5)& innerhtml(clue6, S6) & style(add_hint,display, none) 
            & show_clue_section()


            display(ClueSet) :: evaluate(length(ClueSet), 7) & evaluate(ClueSet, [H1, H2, H3, H4, H5, H6, H7])  
            & generate_single_hint(H1,S1) & generate_single_hint(H2,S2) & generate_single_hint(H3,S3) & generate_single_hint(H4,S4) & generate_single_hint(H5,S5) & generate_single_hint(H6,S6) & generate_single_hint(H7,S7)
            ==> innerhtml(clue1, S1)& innerhtml(clue2, S2)& innerhtml(clue3, S3)& innerhtml(clue4, S4)& innerhtml(clue5, S5)& innerhtml(clue6, S6) & innerhtml(clue7, S7) & style(add_hint,display, none) 
            & show_clue_section() & ~style(clue7, display, none)
            
        
            <!-- fill in the potential answer -->
            fill_in([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) ::
               value(ans_cell(1,1), X11) & value(ans_cell(1,2), X12) & value(ans_cell(1,3), X13) & value(ans_cell(1,4), X14) &
                value(ans_cell(2,1), X21) & value(ans_cell(2,2), X22) & value(ans_cell(2,3), X23) & value(ans_cell(2,4), X24) &
                value(ans_cell(3,1), X31) & value(ans_cell(3,2), X32) & value(ans_cell(3,3), X33) & value(ans_cell(3,4), X34) &
                value(ans_cell(4,1), X41) & value(ans_cell(4,2), X42) & value(ans_cell(4,3), X43) & value(ans_cell(4,4), X44)
                  
            <!-- clue definition -->
            is_clue([Type, Clue]) :- clue_color_of_row(Clue) & evaluate(color_of_row, Type)
            is_clue([Type, Clue]) :- clue_shape_of_cell(Clue) & evaluate(shape_of_cell, Type)
            is_clue([Type, Clue]) :- clue_emoji_of_cell(Clue) & evaluate(emoji_of_cell, Type)
            is_clue([Type, Clue]) :- clue_left_of(Clue) & evaluate(left_of, Type)
            is_clue([Type, Clue]) :- clue_top_of(Clue) & evaluate(top_of, Type)

            <!-- 1. color of a row -->
            clue_color_of_row([Color, R]) :- ~init_puzzle & color(Color) & row(R) & 
                value(ans_cell(R, 1), Emoji) & emoji(Emoji, _, Color)
            <!-- 2. shape of a cell -->
            clue_shape_of_cell([Shape, R, C]) :- ~init_puzzle & shape(Shape) & row(R) & col(C) & 
                value(ans_cell(R, C), Emoji) & emoji(Emoji, Shape, _)
            <!-- 3. emoji of a cell -->
            clue_emoji_of_cell([Emoji, R, C]) :- ~init_puzzle & emoji(Emoji, _, _) & row(R) & col(C) & 
                value(ans_cell(R, C), Emoji)
            <!-- 4. directly to the left ( Emoji1 left, Emoji2 right ) -->
            clue_left_of([Emoji1, Emoji2]) :- ~init_puzzle & row(R) & col(C1) & col(C2) &
                evaluate(minus(C2, 1), C1) & value(ans_cell(R, C1), Emoji1) & value(ans_cell(R, C2), Emoji2)
            <!-- 5. directly on top of ( Emoji1 top, Emoji2 below ) -->
            clue_top_of([Emoji1, Emoji2]) :- ~init_puzzle & row(R1) & row(R2) & col(C) &
                evaluate(minus(R2, 1), R1) & value(ans_cell(R1, C), Emoji1) & value(ans_cell(R2, C), Emoji2)
            <!-- TODO: other not so informative clues, e.g. on the same column -->

            <!-- generate one clue at a time and add to list -->
            random_clue(TypedClue) :- evaluate(choose(X, is_clue(X)), TypedClue)

            generate_clues(0, [])
            generate_clues(N, TypedClue!Rest) :- 
                leq(1, N) &
                evaluate(minus(N, 1), N1)&
                generate_clues(N1, Rest) &
                random_clue(TypedClue)
            
            <!-- remove duplicate clues -->
            remove_duplicates([], [])
            remove_duplicates(E!L, R) :-
                member(E, L) & remove_duplicates(L, R)
            remove_duplicates(E!L, E!R) :-
                ~member(E, L) & remove_duplicates(L, R)

            <!-- get clue set (generate 7 clues and remove duplicates) --> 
            clue_set(ClueSet) :- generate_clues(7, Clues) & remove_duplicates(Clues, ClueSet)

            <!-- rule button -->
            click(rule_button) :: style(rulesModal, display, block) & ~style(rulesModal, display, none)
            click(close_button) :: ~style(rulesModal, display, block) & style(rulesModal, display, none)
    
            <!-- verify solution -->
            click(verify_button) :: ~init_puzzle & check() ==> style(win_message, display, block) & ~style(win_message, display, none)
            click(verify_button) :: ~init_puzzle & check() ==> style(lose_message, display, none) & ~style(lose_message, display, block)

            click(verify_button) :: ~init_puzzle & ~check() ==> style(lose_message, display, block) & ~style(lose_message, display, none)
            click(verify_button) :: ~init_puzzle & ~check() ==> style(win_message, display, none) & ~style(win_message, display, block)

            check() :- ~init_puzzle & user_answer([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) &
                valid_grid([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44])
            <!-- For debug -->
            <!-- check() :- value(cell(1,1), blue_circle) -->

            <!-- user answer -->
            user_answer([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) :-
                value(cell(1,1), X11) & value(cell(1,2), X12) & value(cell(1,3), X13) & value(cell(1,4), X14) &
                value(cell(2,1), X21) & value(cell(2,2), X22) & value(cell(2,3), X23) & value(cell(2,4), X24) &
                value(cell(3,1), X31) & value(cell(3,2), X32) & value(cell(3,3), X33) & value(cell(3,4), X34) &
                value(cell(4,1), X41) & value(cell(4,2), X42) & value(cell(4,3), X43) & value(cell(4,4), X44)
            
            <!-- verify if a grid satisfied the basic rule (don't use it for generation because it is not optimized for generation) -->
            valid_grid([X11, X12, X13, X14, X21, X22, X23, X24, X31, X32, X33, X34, X41, X42, X43, X44]) :-
                emoji(X11, S11, C1) & emoji(X12, S12, C1) & emoji(X13, S13, C1) & emoji(X14, S14, C1) &
                mutex(S11, S12, S13, S14) &
                emoji(X21, S21, C2) & emoji(X22, S22, C2) & emoji(X23, S23, C2) & emoji(X24, S24, C2) &
                mutex(S21, S22, S23, S24) & mutex(C1, C2) &
                emoji(X31, S31, C3) & emoji(X32, S32, C3) & emoji(X33, S33, C3) & emoji(X34, S34, C3) &
                mutex(S31, S32, S33, S34) & mutex(C1, C2, C3) &
                emoji(X41, S41, C4) & emoji(X42, S42, C4) & emoji(X43, S43, C4) & emoji(X44, S44, C4) &
                mutex(S41, S42, S43, S44) & mutex(C1, C2, C3, C4)

            <!-- check answer -->
            click(solution_button) ::  ~init_puzzle ==> style(puzzle_grid_ans, display, block)

        </ruleset>
        <!--=======================================================================-->

    </center>

<!-- The Modal -->
<div id="rulesModal" class="modal">
    <div class="modal-content">
        <span class="close" id="close_button" onclick="modbutton(this)">&times;</span>
        <h2>Here are the rules!</h2>
        <ul>
            <li>Goal: Fill the 4*4 grid with 16 emojis (4 shapes x 4 colors), and satisfy all the rules.</li>
            <li>Rule 1: Each row consists of 4 emojis with the same color</li>
            <li>Rule 2: Each row and each column consists of 4 emojis with distinct shapes </li>
            <li>Rule 3: Clues Section are the constraints that your solution should satisify</li>
            <!-- <li>Rule 4: You win the game if you fulfill Rule 1 & Rule 2 & all the clues</li> -->
        </ul>
    </div>
</div>
<script type="text/javascript" src="./js/epilog.js"></script>
<script type="text/javascript" src="./js/worksheets.js"></script>
<script src="./js/script.js"></script>
</body>

<grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open">
        <style>
            div.grammarly-desktop-integration {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            div.grammarly-desktop-integration:before {
                content: attr(data-content);
            }
        </style>
        <div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration"
            data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}">
        </div>
    </template></grammarly-desktop-integration>

</html>